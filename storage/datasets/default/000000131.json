{
	"title": "Querying a SQL DB | ü¶úÔ∏èüîó Langchain",
	"url": "https://python.langchain.com/docs/expression_language/cookbook/sql_db",
	"html": "LangChain Expression LanguageCookbookQuerying a SQL DB\nQuerying a SQL DB\n\nWe can replicate our SQLDatabaseChain with Runnables.\n\nfrom langchain.prompts import ChatPromptTemplate\n\ntemplate = \"\"\"Based on the table schema below, write a SQL query that would answer the user's question:\n{schema}\n\nQuestion: {question}\nSQL Query:\"\"\"\nprompt = ChatPromptTemplate.from_template(template)\n\nfrom langchain.utilities import SQLDatabase\n\n\nWe'll need the Chinook sample DB for this example. There's many places to download it from, e.g. https://database.guide/2-sample-databases-sqlite/\n\ndb = SQLDatabase.from_uri(\"sqlite:///./Chinook.db\")\n\ndef get_schema(_):\n    return db.get_table_info()\n\ndef run_query(query):\n    return db.run(query)\n\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.schema.output_parser import StrOutputParser\nfrom langchain.schema.runnable import RunnablePassthrough\n\nmodel = ChatOpenAI()\n\nsql_response = (\n    RunnablePassthrough.assign(schema=get_schema)\n    | prompt\n    | model.bind(stop=[\"\\nSQLResult:\"])\n    | StrOutputParser()\n)\n\nsql_response.invoke({\"question\": \"How many employees are there?\"})\n\n    'SELECT COUNT(*) FROM Employee'\n\ntemplate = \"\"\"Based on the table schema below, question, sql query, and sql response, write a natural language response:\n{schema}\n\nQuestion: {question}\nSQL Query: {query}\nSQL Response: {response}\"\"\"\nprompt_response = ChatPromptTemplate.from_template(template)\n\nfull_chain = (\n    RunnablePassthrough.assign(query=sql_response)\n    | RunnablePassthrough.assign(\n        schema=get_schema,\n        response=lambda x: db.run(x[\"query\"]),\n    )\n    | prompt_response\n    | model\n)\n\nfull_chain.invoke({\"question\": \"How many employees are there?\"})\n\n    AIMessage(content='There are 8 employees.', additional_kwargs={}, example=False)\n\nPrevious\nMultiple chains\nNext\nAgents"
}