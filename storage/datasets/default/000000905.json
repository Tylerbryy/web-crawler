{
	"title": "PGVector | ü¶úÔ∏èüîó Langchain",
	"url": "https://python.langchain.com/docs/integrations/vectorstores/pgvector",
	"html": "ComponentsVector storesPGVector\nPGVector\n\nPGVector is an open-source vector similarity search for Postgres\n\nIt supports:\n\nexact and approximate nearest neighbor search\nL2 distance, inner product, and cosine distance\n\nThis notebook shows how to use the Postgres vector database (PGVector).\n\nSee the installation instruction.\n\n# Pip install necessary package\npip install pgvector\npip install openai\npip install psycopg2-binary\npip install tiktoken\n\n\nWe want to use OpenAIEmbeddings so we have to get the OpenAI API Key.\n\nimport getpass\nimport os\n\nos.environ[\"OPENAI_API_KEY\"] = getpass.getpass(\"OpenAI API Key:\")\n\n## Loading Environment Variables\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n    False\n\nfrom langchain.docstore.document import Document\nfrom langchain.document_loaders import TextLoader\nfrom langchain.embeddings.openai import OpenAIEmbeddings\nfrom langchain.text_splitter import CharacterTextSplitter\nfrom langchain.vectorstores.pgvector import PGVector\n\nloader = TextLoader(\"../../modules/state_of_the_union.txt\")\ndocuments = loader.load()\ntext_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)\ndocs = text_splitter.split_documents(documents)\n\nembeddings = OpenAIEmbeddings()\n\n# PGVector needs the connection string to the database.\nCONNECTION_STRING = \"postgresql+psycopg2://harrisonchase@localhost:5432/test3\"\n\n# # Alternatively, you can create it from environment variables.\n# import os\n\n# CONNECTION_STRING = PGVector.connection_string_from_db_params(\n#     driver=os.environ.get(\"PGVECTOR_DRIVER\", \"psycopg2\"),\n#     host=os.environ.get(\"PGVECTOR_HOST\", \"localhost\"),\n#     port=int(os.environ.get(\"PGVECTOR_PORT\", \"5432\")),\n#     database=os.environ.get(\"PGVECTOR_DATABASE\", \"postgres\"),\n#     user=os.environ.get(\"PGVECTOR_USER\", \"postgres\"),\n#     password=os.environ.get(\"PGVECTOR_PASSWORD\", \"postgres\"),\n# )\n\nSimilarity Search with Euclidean Distance (Default)‚Äã\n# The PGVector Module will try to create a table with the name of the collection.\n# So, make sure that the collection name is unique and the user has the permission to create a table.\n\nCOLLECTION_NAME = \"state_of_the_union_test\"\n\ndb = PGVector.from_documents(\n    embedding=embeddings,\n    documents=docs,\n    collection_name=COLLECTION_NAME,\n    connection_string=CONNECTION_STRING,\n)\n\nquery = \"What did the president say about Ketanji Brown Jackson\"\ndocs_with_score = db.similarity_search_with_score(query)\n\nfor doc, score in docs_with_score:\n    print(\"-\" * 80)\n    print(\"Score: \", score)\n    print(doc.page_content)\n    print(\"-\" * 80)\n\n    --------------------------------------------------------------------------------\n    Score:  0.18456886638850434\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.21742627672631343\n    A former top litigator in private practice. A former federal public defender. And from a family of public school educators and police officers. A consensus builder. Since she‚Äôs been nominated, she‚Äôs received a broad range of support‚Äîfrom the Fraternal Order of Police to former judges appointed by Democrats and Republicans. \n    \n    And if we are to advance liberty and justice, we need to secure the Border and fix the immigration system. \n    \n    We can do both. At our border, we‚Äôve installed new technology like cutting-edge scanners to better detect drug smuggling.  \n    \n    We‚Äôve set up joint patrols with Mexico and Guatemala to catch more human traffickers.  \n    \n    We‚Äôre putting in place dedicated immigration judges so families fleeing persecution and violence can have their cases heard faster. \n    \n    We‚Äôre securing commitments and supporting partners in South and Central America to host more refugees and secure their own borders.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.22641793174529334\n    And for our LGBTQ+ Americans, let‚Äôs finally get the bipartisan Equality Act to my desk. The onslaught of state laws targeting transgender Americans and their families is wrong. \n    \n    As I said last year, especially to our younger transgender Americans, I will always have your back as your President, so you can be yourself and reach your God-given potential. \n    \n    While it often appears that we never agree, that isn‚Äôt true. I signed 80 bipartisan bills into law last year. From preventing government shutdowns to protecting Asian-Americans from still-too-common hate crimes to reforming military justice. \n    \n    And soon, we‚Äôll strengthen the Violence Against Women Act that I first wrote three decades ago. It is important for us to show the nation that we can come together and do big things. \n    \n    So tonight I‚Äôm offering a Unity Agenda for the Nation. Four big things we can do together.  \n    \n    First, beat the opioid epidemic.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.22670040608054465\n    Tonight, I‚Äôm announcing a crackdown on these companies overcharging American businesses and consumers. \n    \n    And as Wall Street firms take over more nursing homes, quality in those homes has gone down and costs have gone up.  \n    \n    That ends on my watch. \n    \n    Medicare is going to set higher standards for nursing homes and make sure your loved ones get the care they deserve and expect. \n    \n    We‚Äôll also cut costs and keep the economy going strong by giving workers a fair shot, provide more training and apprenticeships, hire them based on their skills not degrees. \n    \n    Let‚Äôs pass the Paycheck Fairness Act and paid leave.  \n    \n    Raise the minimum wage to $15 an hour and extend the Child Tax Credit, so no one has to raise a family in poverty. \n    \n    Let‚Äôs increase Pell Grants and increase our historic support of HBCUs, and invest in what Jill‚Äîour First Lady who teaches full-time‚Äîcalls America‚Äôs best-kept secret: community colleges.\n    --------------------------------------------------------------------------------\n\nMaximal Marginal Relevance Search (MMR)‚Äã\n\nMaximal marginal relevance optimizes for similarity to query AND diversity among selected documents.\n\ndocs_with_score = db.max_marginal_relevance_search_with_score(query)\n\nfor doc, score in docs_with_score:\n    print(\"-\" * 80)\n    print(\"Score: \", score)\n    print(doc.page_content)\n    print(\"-\" * 80)\n\n    --------------------------------------------------------------------------------\n    Score:  0.18453882564037527\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.23523731441720075\n    We can‚Äôt change how divided we‚Äôve been. But we can change how we move forward‚Äîon COVID-19 and other issues we must face together. \n    \n    I recently visited the New York City Police Department days after the funerals of Officer Wilbert Mora and his partner, Officer Jason Rivera. \n    \n    They were responding to a 9-1-1 call when a man shot and killed them with a stolen gun. \n    \n    Officer Mora was 27 years old. \n    \n    Officer Rivera was 22. \n    \n    Both Dominican Americans who‚Äôd grown up on the same streets they later chose to patrol as police officers. \n    \n    I spoke with their families and told them that we are forever in debt for their sacrifice, and we will carry on their mission to restore the trust and safety every community deserves. \n    \n    I‚Äôve worked on these issues a long time. \n    \n    I know what works: Investing in crime prevention and community police officers who‚Äôll walk the beat, who‚Äôll know the neighborhood, and who can restore trust and safety.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.2448441215698569\n    One was stationed at bases and breathing in toxic smoke from ‚Äúburn pits‚Äù that incinerated wastes of war‚Äîmedical and hazard material, jet fuel, and more. \n    \n    When they came home, many of the world‚Äôs fittest and best trained warriors were never the same. \n    \n    Headaches. Numbness. Dizziness. \n    \n    A cancer that would put them in a flag-draped coffin. \n    \n    I know. \n    \n    One of those soldiers was my son Major Beau Biden. \n    \n    We don‚Äôt know for sure if a burn pit was the cause of his brain cancer, or the diseases of so many of our troops. \n    \n    But I‚Äôm committed to finding out everything we can. \n    \n    Committed to military families like Danielle Robinson from Ohio. \n    \n    The widow of Sergeant First Class Heath Robinson.  \n    \n    He was born a soldier. Army National Guard. Combat medic in Kosovo and Iraq. \n    \n    Stationed near Baghdad, just yards from burn pits the size of football fields. \n    \n    Heath‚Äôs widow Danielle is here with us tonight. They loved going to Ohio State football games. He loved building Legos with their daughter.\n    --------------------------------------------------------------------------------\n    --------------------------------------------------------------------------------\n    Score:  0.2513994424701056\n    And I‚Äôm taking robust action to make sure the pain of our sanctions  is targeted at Russia‚Äôs economy. And I will use every tool at our disposal to protect American businesses and consumers. \n    \n    Tonight, I can announce that the United States has worked with 30 other countries to release 60 Million barrels of oil from reserves around the world.  \n    \n    America will lead that effort, releasing 30 Million barrels from our own Strategic Petroleum Reserve. And we stand ready to do more if necessary, unified with our allies.  \n    \n    These steps will help blunt gas prices here at home. And I know the news about what‚Äôs happening can seem alarming. \n    \n    But I want you to know that we are going to be okay. \n    \n    When the history of this era is written Putin‚Äôs war on Ukraine will have left Russia weaker and the rest of the world stronger. \n    \n    While it shouldn‚Äôt have taken something so terrible for people around the world to see what‚Äôs at stake now everyone sees it clearly.\n    --------------------------------------------------------------------------------\n\nWorking with vectorstore‚Äã\n\nAbove, we created a vectorstore from scratch. However, often times we want to work with an existing vectorstore. In order to do that, we can initialize it directly.\n\nstore = PGVector(\n    collection_name=COLLECTION_NAME,\n    connection_string=CONNECTION_STRING,\n    embedding_function=embeddings,\n)\n\nAdd documents‚Äã\n\nWe can add documents to the existing vectorstore.\n\nstore.add_documents([Document(page_content=\"foo\")])\n\n    ['048c2e14-1cf3-11ee-8777-e65801318980']\n\ndocs_with_score = db.similarity_search_with_score(\"foo\")\n\ndocs_with_score[0]\n\n    (Document(page_content='foo', metadata={}), 3.3203430005457335e-09)\n\ndocs_with_score[1]\n\n    (Document(page_content='A former top litigator in private practice. A former federal public defender. And from a family of public school educators and police officers. A consensus builder. Since she‚Äôs been nominated, she‚Äôs received a broad range of support‚Äîfrom the Fraternal Order of Police to former judges appointed by Democrats and Republicans. \\n\\nAnd if we are to advance liberty and justice, we need to secure the Border and fix the immigration system. \\n\\nWe can do both. At our border, we‚Äôve installed new technology like cutting-edge scanners to better detect drug smuggling.  \\n\\nWe‚Äôve set up joint patrols with Mexico and Guatemala to catch more human traffickers.  \\n\\nWe‚Äôre putting in place dedicated immigration judges so families fleeing persecution and violence can have their cases heard faster. \\n\\nWe‚Äôre securing commitments and supporting partners in South and Central America to host more refugees and secure their own borders.', metadata={'source': '../../../state_of_the_union.txt'}),\n     0.2404395365581814)\n\nOverriding a vectorstore‚Äã\n\nIf you have an existing collection, you override it by doing from_documents and setting pre_delete_collection = True\n\ndb = PGVector.from_documents(\n    documents=docs,\n    embedding=embeddings,\n    collection_name=COLLECTION_NAME,\n    connection_string=CONNECTION_STRING,\n    pre_delete_collection=True,\n)\n\ndocs_with_score = db.similarity_search_with_score(\"foo\")\n\ndocs_with_score[0]\n\n    (Document(page_content='A former top litigator in private practice. A former federal public defender. And from a family of public school educators and police officers. A consensus builder. Since she‚Äôs been nominated, she‚Äôs received a broad range of support‚Äîfrom the Fraternal Order of Police to former judges appointed by Democrats and Republicans. \\n\\nAnd if we are to advance liberty and justice, we need to secure the Border and fix the immigration system. \\n\\nWe can do both. At our border, we‚Äôve installed new technology like cutting-edge scanners to better detect drug smuggling.  \\n\\nWe‚Äôve set up joint patrols with Mexico and Guatemala to catch more human traffickers.  \\n\\nWe‚Äôre putting in place dedicated immigration judges so families fleeing persecution and violence can have their cases heard faster. \\n\\nWe‚Äôre securing commitments and supporting partners in South and Central America to host more refugees and secure their own borders.', metadata={'source': '../../../state_of_the_union.txt'}),\n     0.2404115088144465)\n\nUsing a VectorStore as a Retriever‚Äã\nretriever = store.as_retriever()\n\nprint(retriever)\n\n    tags=None metadata=None vectorstore=<langchain.vectorstores.pgvector.PGVector object at 0x29f94f880> search_type='similarity' search_kwargs={}\n\nPrevious\nPGVecto.rs\nNext\nPinecone"
}