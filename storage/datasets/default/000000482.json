{
	"title": "Self-ask with search | 🦜️🔗 Langchain",
	"url": "https://python.langchain.com/docs/modules/agents/agent_types/self_ask_with_search",
	"html": "ModulesAgentsAgent TypesSelf-ask with search\nSelf-ask with search\n\nThis walkthrough showcases the self-ask with search chain.\n\nfrom langchain.agents import AgentType, Tool, initialize_agent\nfrom langchain.llms import OpenAI\nfrom langchain.utilities import SerpAPIWrapper\n\nllm = OpenAI(temperature=0)\nsearch = SerpAPIWrapper()\ntools = [\n    Tool(\n        name=\"Intermediate Answer\",\n        func=search.run,\n        description=\"useful for when you need to ask with search\",\n    )\n]\n\nUsing LangChain Expression Language​\n\nFirst we will show how to construct this agent from components using LangChain Expression Language\n\nfrom langchain import hub\nfrom langchain.agents.format_scratchpad import format_log_to_str\nfrom langchain.agents.output_parsers import SelfAskOutputParser\n\nprompt = hub.pull(\"hwchase17/self-ask-with-search\")\n\nllm_with_stop = llm.bind(stop=[\"\\nIntermediate answer:\"])\n\nagent = (\n    {\n        \"input\": lambda x: x[\"input\"],\n        # Use some custom observation_prefix/llm_prefix for formatting\n        \"agent_scratchpad\": lambda x: format_log_to_str(\n            x[\"intermediate_steps\"],\n            observation_prefix=\"\\nIntermediate answer: \",\n            llm_prefix=\"\",\n        ),\n    }\n    | prompt\n    | llm_with_stop\n    | SelfAskOutputParser()\n)\n\nfrom langchain.agents import AgentExecutor\n\nagent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)\n\nagent_executor.invoke(\n    {\"input\": \"What is the hometown of the reigning men's U.S. Open champion?\"}\n)\n\n    \n    \n    > Entering new AgentExecutor chain...\n     Yes.\n    Follow up: Who is the reigning men's U.S. Open champion?Men's US Open Tennis Champions Novak Djokovic earned his 24th major singles title against 2021 US Open champion Daniil Medvedev, 6-3, 7-6 (7-5), 6-3. The victory ties the Serbian player with the legendary Margaret Court for the most Grand Slam wins across both men's and women's singles.\n    Follow up: Where is Novak Djokovic from?Belgrade, Serbia\n    So the final answer is: Belgrade, Serbia\n    \n    > Finished chain.\n\n\n\n\n\n    {'input': \"What is the hometown of the reigning men's U.S. Open champion?\",\n     'output': 'Belgrade, Serbia'}\n\nUse off-the-shelf agent​\nself_ask_with_search = initialize_agent(\n    tools, llm, agent=AgentType.SELF_ASK_WITH_SEARCH, verbose=True\n)\nself_ask_with_search.run(\n    \"What is the hometown of the reigning men's U.S. Open champion?\"\n)\n\n    \n    \n    > Entering new AgentExecutor chain...\n     Yes.\n    Follow up: Who is the reigning men's U.S. Open champion?\n    Intermediate answer: Men's US Open Tennis Champions Novak Djokovic earned his 24th major singles title against 2021 US Open champion Daniil Medvedev, 6-3, 7-6 (7-5), 6-3. The victory ties the Serbian player with the legendary Margaret Court for the most Grand Slam wins across both men's and women's singles.\n    \n    Follow up: Where is Novak Djokovic from?\n    Intermediate answer: Belgrade, Serbia\n    So the final answer is: Belgrade, Serbia\n    \n    > Finished chain.\n\n\n\n\n\n    'Belgrade, Serbia'\n\nPrevious\nReAct document store\nNext\nStructured tool chat"
}