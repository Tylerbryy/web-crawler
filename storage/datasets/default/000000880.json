{
	"title": "Chroma | ü¶úÔ∏èüîó Langchain",
	"url": "https://python.langchain.com/docs/integrations/vectorstores/chroma",
	"html": "ComponentsVector storesChroma\nChroma\n\nChroma is a AI-native open-source vector database focused on developer productivity and happiness. Chroma is licensed under Apache 2.0.\n\nInstall Chroma with:\n\npip install chromadb\n\n\nChroma runs in various modes. See below for examples of each integrated with LangChain.\n\nin-memory - in a python script or jupyter notebook\nin-memory with persistance - in a script or notebook and save/load to disk\nin a docker container - as a server running your local machine or in the cloud\n\nLike any other database, you can:\n\n.add\n.get\n.update\n.upsert\n.delete\n.peek\nand .query runs the similarity search.\n\nView full docs at docs. To access these methods directly, you can do ._collection.method()\n\nBasic Example‚Äã\n\nIn this basic example, we take the most recent State of the Union Address, split it into chunks, embed it using an open-source embedding model, load it into Chroma, and then query it.\n\n# import\nfrom langchain.document_loaders import TextLoader\nfrom langchain.embeddings.sentence_transformer import SentenceTransformerEmbeddings\nfrom langchain.text_splitter import CharacterTextSplitter\nfrom langchain.vectorstores import Chroma\n\n# load the document and split it into chunks\nloader = TextLoader(\"../../modules/state_of_the_union.txt\")\ndocuments = loader.load()\n\n# split it into chunks\ntext_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)\ndocs = text_splitter.split_documents(documents)\n\n# create the open-source embedding function\nembedding_function = SentenceTransformerEmbeddings(model_name=\"all-MiniLM-L6-v2\")\n\n# load it into Chroma\ndb = Chroma.from_documents(docs, embedding_function)\n\n# query it\nquery = \"What did the president say about Ketanji Brown Jackson\"\ndocs = db.similarity_search(query)\n\n# print results\nprint(docs[0].page_content)\n\n    /Users/jeff/.pyenv/versions/3.10.10/lib/python3.10/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n      from .autonotebook import tqdm as notebook_tqdm\n\n\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n\nBasic Example (including saving to disk)‚Äã\n\nExtending the previous example, if you want to save to disk, simply initialize the Chroma client and pass the directory where you want the data to be saved to.\n\nCaution: Chroma makes a best-effort to automatically save data to disk, however multiple in-memory clients can stomp each other's work. As a best practice, only have one client per path running at any given time.\n\n# save to disk\ndb2 = Chroma.from_documents(docs, embedding_function, persist_directory=\"./chroma_db\")\ndocs = db2.similarity_search(query)\n\n# load from disk\ndb3 = Chroma(persist_directory=\"./chroma_db\", embedding_function=embedding_function)\ndocs = db3.similarity_search(query)\nprint(docs[0].page_content)\n\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n\nPassing a Chroma Client into Langchain‚Äã\n\nYou can also create a Chroma Client and pass it to LangChain. This is particularly useful if you want easier access to the underlying database.\n\nYou can also specify the collection name that you want LangChain to use.\n\nimport chromadb\n\npersistent_client = chromadb.PersistentClient()\ncollection = persistent_client.get_or_create_collection(\"collection_name\")\ncollection.add(ids=[\"1\", \"2\", \"3\"], documents=[\"a\", \"b\", \"c\"])\n\nlangchain_chroma = Chroma(\n    client=persistent_client,\n    collection_name=\"collection_name\",\n    embedding_function=embedding_function,\n)\n\nprint(\"There are\", langchain_chroma._collection.count(), \"in the collection\")\n\n    Add of existing embedding ID: 1\n    Add of existing embedding ID: 2\n    Add of existing embedding ID: 3\n    Add of existing embedding ID: 1\n    Add of existing embedding ID: 2\n    Add of existing embedding ID: 3\n    Add of existing embedding ID: 1\n    Insert of existing embedding ID: 1\n    Add of existing embedding ID: 2\n    Insert of existing embedding ID: 2\n    Add of existing embedding ID: 3\n    Insert of existing embedding ID: 3\n\n\n    There are 3 in the collection\n\nBasic Example (using the Docker Container)‚Äã\n\nYou can also run the Chroma Server in a Docker container separately, create a Client to connect to it, and then pass that to LangChain.\n\nChroma has the ability to handle multiple Collections of documents, but the LangChain interface expects one, so we need to specify the collection name. The default collection name used by LangChain is \"langchain\".\n\nHere is how to clone, build, and run the Docker Image:\n\ngit clone git@github.com:chroma-core/chroma.git\n\n\nEdit the docker-compose.yml file and add ALLOW_RESET=TRUE under environment\n\n    ...\n    command: uvicorn chromadb.app:app --reload --workers 1 --host 0.0.0.0 --port 8000 --log-config log_config.yml\n    environment:\n      - IS_PERSISTENT=TRUE\n      - ALLOW_RESET=TRUE\n    ports:\n      - 8000:8000\n    ...\n\n\nThen run docker-compose up -d --build\n\n# create the chroma client\nimport uuid\n\nimport chromadb\nfrom chromadb.config import Settings\n\nclient = chromadb.HttpClient(settings=Settings(allow_reset=True))\nclient.reset()  # resets the database\ncollection = client.create_collection(\"my_collection\")\nfor doc in docs:\n    collection.add(\n        ids=[str(uuid.uuid1())], metadatas=doc.metadata, documents=doc.page_content\n    )\n\n# tell LangChain to use our client and collection name\ndb4 = Chroma(\n    client=client,\n    collection_name=\"my_collection\",\n    embedding_function=embedding_function,\n)\nquery = \"What did the president say about Ketanji Brown Jackson\"\ndocs = db4.similarity_search(query)\nprint(docs[0].page_content)\n\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n\nUpdate and Delete‚Äã\n\nWhile building toward a real application, you want to go beyond adding data, and also update and delete data.\n\nChroma has users provide ids to simplify the bookkeeping here. ids can be the name of the file, or a combined has like filename_paragraphNumber, etc.\n\nChroma supports all these operations - though some of them are still being integrated all the way through the LangChain interface. Additional workflow improvements will be added soon.\n\nHere is a basic example showing how to do various operations:\n\n# create simple ids\nids = [str(i) for i in range(1, len(docs) + 1)]\n\n# add data\nexample_db = Chroma.from_documents(docs, embedding_function, ids=ids)\ndocs = example_db.similarity_search(query)\nprint(docs[0].metadata)\n\n# update the metadata for a document\ndocs[0].metadata = {\n    \"source\": \"../../modules/state_of_the_union.txt\",\n    \"new_value\": \"hello world\",\n}\nexample_db.update_document(ids[0], docs[0])\nprint(example_db._collection.get(ids=[ids[0]]))\n\n# delete the last document\nprint(\"count before\", example_db._collection.count())\nexample_db._collection.delete(ids=[ids[-1]])\nprint(\"count after\", example_db._collection.count())\n\n    {'source': '../../../state_of_the_union.txt'}\n    {'ids': ['1'], 'embeddings': None, 'metadatas': [{'new_value': 'hello world', 'source': '../../../state_of_the_union.txt'}], 'documents': ['Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \\n\\nTonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \\n\\nOne of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \\n\\nAnd I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.']}\n    count before 46\n    count after 45\n\nUse OpenAI Embeddings‚Äã\n\nMany people like to use OpenAIEmbeddings, here is how to set that up.\n\n# get a token: https://platform.openai.com/account/api-keys\n\nfrom getpass import getpass\n\nfrom langchain.embeddings.openai import OpenAIEmbeddings\n\nOPENAI_API_KEY = getpass()\n\nimport os\n\nos.environ[\"OPENAI_API_KEY\"] = OPENAI_API_KEY\n\nembeddings = OpenAIEmbeddings()\nnew_client = chromadb.EphemeralClient()\nopenai_lc_client = Chroma.from_documents(\n    docs, embeddings, client=new_client, collection_name=\"openai_collection\"\n)\n\nquery = \"What did the president say about Ketanji Brown Jackson\"\ndocs = openai_lc_client.similarity_search(query)\nprint(docs[0].page_content)\n\n    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \n    \n    Tonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n    \n    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n    \n    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.\n\nOther Information‚Äã\nSimilarity search with score‚Äã\n\nThe returned distance score is cosine distance. Therefore, a lower score is better.\n\ndocs = db.similarity_search_with_score(query)\n\ndocs[0]\n\n    (Document(page_content='Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \\n\\nTonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \\n\\nOne of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \\n\\nAnd I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.', metadata={'source': '../../../state_of_the_union.txt'}),\n     1.1972057819366455)\n\nRetriever options‚Äã\n\nThis section goes over different options for how to use Chroma as a retriever.\n\nMMR‚Äã\n\nIn addition to using similarity search in the retriever object, you can also use mmr.\n\nretriever = db.as_retriever(search_type=\"mmr\")\n\nretriever.get_relevant_documents(query)[0]\n\n    Document(page_content='Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you‚Äôre at it, pass the Disclose Act so Americans can know who is funding our elections. \\n\\nTonight, I‚Äôd like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer‚Äîan Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \\n\\nOne of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \\n\\nAnd I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation‚Äôs top legal minds, who will continue Justice Breyer‚Äôs legacy of excellence.', metadata={'source': '../../../state_of_the_union.txt'})\n\nFiltering on metadata‚Äã\n\nIt can be helpful to narrow down the collection before working with it.\n\nFor example, collections can be filtered on metadata using the get method.\n\n# filter collection for updated source\nexample_db.get(where={\"source\": \"some_other_source\"})\n\n    {'ids': [], 'embeddings': None, 'metadatas': [], 'documents': []}\n\nPrevious\nBaidu Cloud ElasticSearch VectorSearch\nNext\nClarifai"
}