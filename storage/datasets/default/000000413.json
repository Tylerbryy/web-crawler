{
	"title": "Tracking token usage | ðŸ¦œï¸ðŸ”— Langchain",
	"url": "https://python.langchain.com/docs/modules/model_io/chat/token_usage_tracking",
	"html": "ModulesModel I/OChat modelsTracking token usage\nTracking token usage\n\nThis notebook goes over how to track your token usage for specific calls. It is currently only implemented for the OpenAI API.\n\nLet's first look at an extremely simple example of tracking token usage for a single Chat model call.\n\nfrom langchain.callbacks import get_openai_callback\nfrom langchain.chat_models import ChatOpenAI\n\nllm = ChatOpenAI(model_name=\"gpt-4\")\n\nwith get_openai_callback() as cb:\n    result = llm.invoke(\"Tell me a joke\")\n    print(cb)\n\n    Tokens Used: 24\n        Prompt Tokens: 11\n        Completion Tokens: 13\n    Successful Requests: 1\n    Total Cost (USD): $0.0011099999999999999\n\n\nAnything inside the context manager will get tracked. Here's an example of using it to track multiple calls in sequence.\n\nwith get_openai_callback() as cb:\n    result = llm.invoke(\"Tell me a joke\")\n    result2 = llm.invoke(\"Tell me a joke\")\n    print(cb.total_tokens)\n\n    48\n\n\nIf a chain or agent with multiple steps in it is used, it will track all those steps.\n\nfrom langchain.agents import AgentType, initialize_agent, load_tools\nfrom langchain.llms import OpenAI\n\ntools = load_tools([\"serpapi\", \"llm-math\"], llm=llm)\nagent = initialize_agent(tools, llm, agent=AgentType.OPENAI_FUNCTIONS, verbose=True)\n\nwith get_openai_callback() as cb:\n    response = agent.run(\n        \"Who is Olivia Wilde's boyfriend? What is his current age raised to the 0.23 power?\"\n    )\n    print(f\"Total Tokens: {cb.total_tokens}\")\n    print(f\"Prompt Tokens: {cb.prompt_tokens}\")\n    print(f\"Completion Tokens: {cb.completion_tokens}\")\n    print(f\"Total Cost (USD): ${cb.total_cost}\")\n\n    \n    \n    > Entering new AgentExecutor chain...\n    \n    Invoking: `Search` with `Olivia Wilde's current boyfriend`\n    \n    \n    ['Things are looking golden for Olivia Wilde, as the actress has jumped back into the dating pool following her split from Harry Styles â€” read ...', \"â€œI did not want service to take place at the home of Olivia's current partner because Otis and Daisy might be present,â€ Sudeikis wrote in his ...\", \"February 2021: Olivia Wilde praises Harry Styles' modesty. One month after the duo made headlines with their budding romance, Wilde gave her new beau major ...\", 'An insider revealed to People that the new couple had been dating for some time. \"They were in Montecito, California this weekend for a wedding, ...', 'A source told People last year that Wilde and Styles were still friends despite deciding to take a break. \"He\\'s still touring and is now going ...', \"... love life. â€œHe's your typical average Joe.â€ The source adds, â€œShe's not giving too much away right now and wants to keep the relationship ...\", \"Multiple sources said the two were â€œtaking a breakâ€ from dating because of distance and different priorities. â€œHe's still touring and is now ...\", 'Comments. Filed under. celebrity couples Â· celebrity dating Â· harry styles Â· jason sudeikis Â· olivia wilde ... Now Holds A Darker MeaningNYPost.', '... dating during filming. The 39-year-old did however look very cosy with the comedian, although his relationship status is unknown. Olivia ...']\n    Invoking: `Search` with `Harry Styles current age`\n    responded: Olivia Wilde's current boyfriend is Harry Styles. Let me find out his age for you.\n    \n    29 years\n    Invoking: `Calculator` with `29 ^ 0.23`\n    \n    \n    Answer: 2.169459462491557Harry Styles' current age (29 years) raised to the 0.23 power is approximately 2.17.\n    \n    > Finished chain.\n    Total Tokens: 1929\n    Prompt Tokens: 1799\n    Completion Tokens: 130\n    Total Cost (USD): $0.06176999999999999\n\nPrevious\nStreaming\nNext\nLLMs"
}