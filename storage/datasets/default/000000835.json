{
	"title": "Shared memory across agents and tools | 🦜️🔗 Langchain",
	"url": "https://python.langchain.com/docs/modules/agents/how_to/sharedmemory_for_tools",
	"html": "ModulesAgentsHow-toShared memory across agents and tools\nShared memory across agents and tools\n\nThis notebook goes over adding memory to both an Agent and its tools. Before going through this notebook, please walk through the following notebooks, as this will build on top of both of them:\n\nAdding memory to an LLM Chain\nCustom Agents\n\nWe are going to create a custom Agent. The agent has access to a conversation memory, search tool, and a summarization tool. The summarization tool also needs access to the conversation memory.\n\nfrom langchain.agents import AgentExecutor, Tool, ZeroShotAgent\nfrom langchain.chains import LLMChain\nfrom langchain.llms import OpenAI\nfrom langchain.memory import ConversationBufferMemory, ReadOnlySharedMemory\nfrom langchain.prompts import PromptTemplate\nfrom langchain.utilities import GoogleSearchAPIWrapper\n\ntemplate = \"\"\"This is a conversation between a human and a bot:\n\n{chat_history}\n\nWrite a summary of the conversation for {input}:\n\"\"\"\n\nprompt = PromptTemplate(input_variables=[\"input\", \"chat_history\"], template=template)\nmemory = ConversationBufferMemory(memory_key=\"chat_history\")\nreadonlymemory = ReadOnlySharedMemory(memory=memory)\nsummary_chain = LLMChain(\n    llm=OpenAI(),\n    prompt=prompt,\n    verbose=True,\n    memory=readonlymemory,  # use the read-only memory to prevent the tool from modifying the memory\n)\n\nsearch = GoogleSearchAPIWrapper()\ntools = [\n    Tool(\n        name=\"Search\",\n        func=search.run,\n        description=\"useful for when you need to answer questions about current events\",\n    ),\n    Tool(\n        name=\"Summary\",\n        func=summary_chain.run,\n        description=\"useful for when you summarize a conversation. The input to this tool should be a string, representing who will read this summary.\",\n    ),\n]\n\nprefix = \"\"\"Have a conversation with a human, answering the following questions as best you can. You have access to the following tools:\"\"\"\nsuffix = \"\"\"Begin!\"\n\n{chat_history}\nQuestion: {input}\n{agent_scratchpad}\"\"\"\n\nprompt = ZeroShotAgent.create_prompt(\n    tools,\n    prefix=prefix,\n    suffix=suffix,\n    input_variables=[\"input\", \"chat_history\", \"agent_scratchpad\"],\n)\n\n\nWe can now construct the LLMChain, with the Memory object, and then create the agent.\n\nllm_chain = LLMChain(llm=OpenAI(temperature=0), prompt=prompt)\nagent = ZeroShotAgent(llm_chain=llm_chain, tools=tools, verbose=True)\nagent_chain = AgentExecutor.from_agent_and_tools(\n    agent=agent, tools=tools, verbose=True, memory=memory\n)\n\nagent_chain.run(input=\"What is ChatGPT?\")\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I should research ChatGPT to answer this question.\n    Action: Search\n    Action Input: \"ChatGPT\"\n    Observation: Nov 30, 2022 ... We've trained a model called ChatGPT which interacts in a conversational way. The dialogue format makes it possible for ChatGPT to answer ... ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large ... ChatGPT. We've trained a model called ChatGPT which interacts in a conversational way. The dialogue format makes it possible for ChatGPT to answer ... Feb 2, 2023 ... ChatGPT, the popular chatbot from OpenAI, is estimated to have reached 100 million monthly active users in January, just two months after ... 2 days ago ... ChatGPT recently launched a new version of its own plagiarism detection tool, with hopes that it will squelch some of the criticism around how ... An API for accessing new AI models developed by OpenAI. Feb 19, 2023 ... ChatGPT is an AI chatbot system that OpenAI released in November to show off and test what a very large, powerful AI system can accomplish. You ... ChatGPT is fine-tuned from GPT-3.5, a language model trained to produce text. ChatGPT was optimized for dialogue by using Reinforcement Learning with Human ... 3 days ago ... Visual ChatGPT connects ChatGPT and a series of Visual Foundation Models to enable sending and receiving images during chatting. Dec 1, 2022 ... ChatGPT is a natural language processing tool driven by AI technology that allows you to have human-like conversations and much more with a ...\n    Thought: I now know the final answer.\n    Final Answer: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    \n    > Finished chain.\n\n\n\n\n\n    \"ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\"\n\n\nTo test the memory of this agent, we can ask a followup question that relies on information in the previous exchange to be answered correctly.\n\nagent_chain.run(input=\"Who developed it?\")\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I need to find out who developed ChatGPT\n    Action: Search\n    Action Input: Who developed ChatGPT\n    Observation: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large ... Feb 15, 2023 ... Who owns Chat GPT? Chat GPT is owned and developed by AI research and deployment company, OpenAI. The organization is headquartered in San ... Feb 8, 2023 ... ChatGPT is an AI chatbot developed by San Francisco-based startup OpenAI. OpenAI was co-founded in 2015 by Elon Musk and Sam Altman and is ... Dec 7, 2022 ... ChatGPT is an AI chatbot designed and developed by OpenAI. The bot works by generating text responses based on human-user input, like questions ... Jan 12, 2023 ... In 2019, Microsoft invested $1 billion in OpenAI, the tiny San Francisco company that designed ChatGPT. And in the years since, it has quietly ... Jan 25, 2023 ... The inside story of ChatGPT: How OpenAI founder Sam Altman built the world's hottest technology with billions from Microsoft. Dec 3, 2022 ... ChatGPT went viral on social media for its ability to do anything from code to write essays. · The company that created the AI chatbot has a ... Jan 17, 2023 ... While many Americans were nursing hangovers on New Year's Day, 22-year-old Edward Tian was working feverishly on a new app to combat misuse ... ChatGPT is a language model created by OpenAI, an artificial intelligence research laboratory consisting of a team of researchers and engineers focused on ... 1 day ago ... Everyone is talking about ChatGPT, developed by OpenAI. This is such a great tool that has helped to make AI more accessible to a wider ...\n    Thought: I now know the final answer\n    Final Answer: ChatGPT was developed by OpenAI.\n    \n    > Finished chain.\n\n\n\n\n\n    'ChatGPT was developed by OpenAI.'\n\nagent_chain.run(\n    input=\"Thanks. Summarize the conversation, for my daughter 5 years old.\"\n)\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I need to simplify the conversation for a 5 year old.\n    Action: Summary\n    Action Input: My daughter 5 years old\n    \n    > Entering new LLMChain chain...\n    Prompt after formatting:\n    This is a conversation between a human and a bot:\n    \n    Human: What is ChatGPT?\n    AI: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    Human: Who developed it?\n    AI: ChatGPT was developed by OpenAI.\n    \n    Write a summary of the conversation for My daughter 5 years old:\n    \n    \n    > Finished chain.\n    \n    Observation: \n    The conversation was about ChatGPT, an artificial intelligence chatbot. It was created by OpenAI and can send and receive images while chatting.\n    Thought: I now know the final answer.\n    Final Answer: ChatGPT is an artificial intelligence chatbot created by OpenAI that can send and receive images while chatting.\n    \n    > Finished chain.\n\n\n\n\n\n    'ChatGPT is an artificial intelligence chatbot created by OpenAI that can send and receive images while chatting.'\n\n\nConfirm that the memory was correctly updated.\n\nprint(agent_chain.memory.buffer)\n\n    Human: What is ChatGPT?\n    AI: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    Human: Who developed it?\n    AI: ChatGPT was developed by OpenAI.\n    Human: Thanks. Summarize the conversation, for my daughter 5 years old.\n    AI: ChatGPT is an artificial intelligence chatbot created by OpenAI that can send and receive images while chatting.\n\n\nFor comparison, below is a bad example that uses the same memory for both the Agent and the tool.\n\n## This is a bad practice for using the memory.\n## Use the ReadOnlySharedMemory class, as shown above.\n\ntemplate = \"\"\"This is a conversation between a human and a bot:\n\n{chat_history}\n\nWrite a summary of the conversation for {input}:\n\"\"\"\n\nprompt = PromptTemplate(input_variables=[\"input\", \"chat_history\"], template=template)\nmemory = ConversationBufferMemory(memory_key=\"chat_history\")\nsummary_chain = LLMChain(\n    llm=OpenAI(),\n    prompt=prompt,\n    verbose=True,\n    memory=memory,  # <--- this is the only change\n)\n\nsearch = GoogleSearchAPIWrapper()\ntools = [\n    Tool(\n        name=\"Search\",\n        func=search.run,\n        description=\"useful for when you need to answer questions about current events\",\n    ),\n    Tool(\n        name=\"Summary\",\n        func=summary_chain.run,\n        description=\"useful for when you summarize a conversation. The input to this tool should be a string, representing who will read this summary.\",\n    ),\n]\n\nprefix = \"\"\"Have a conversation with a human, answering the following questions as best you can. You have access to the following tools:\"\"\"\nsuffix = \"\"\"Begin!\"\n\n{chat_history}\nQuestion: {input}\n{agent_scratchpad}\"\"\"\n\nprompt = ZeroShotAgent.create_prompt(\n    tools,\n    prefix=prefix,\n    suffix=suffix,\n    input_variables=[\"input\", \"chat_history\", \"agent_scratchpad\"],\n)\n\nllm_chain = LLMChain(llm=OpenAI(temperature=0), prompt=prompt)\nagent = ZeroShotAgent(llm_chain=llm_chain, tools=tools, verbose=True)\nagent_chain = AgentExecutor.from_agent_and_tools(\n    agent=agent, tools=tools, verbose=True, memory=memory\n)\n\nagent_chain.run(input=\"What is ChatGPT?\")\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I should research ChatGPT to answer this question.\n    Action: Search\n    Action Input: \"ChatGPT\"\n    Observation: Nov 30, 2022 ... We've trained a model called ChatGPT which interacts in a conversational way. The dialogue format makes it possible for ChatGPT to answer ... ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large ... ChatGPT. We've trained a model called ChatGPT which interacts in a conversational way. The dialogue format makes it possible for ChatGPT to answer ... Feb 2, 2023 ... ChatGPT, the popular chatbot from OpenAI, is estimated to have reached 100 million monthly active users in January, just two months after ... 2 days ago ... ChatGPT recently launched a new version of its own plagiarism detection tool, with hopes that it will squelch some of the criticism around how ... An API for accessing new AI models developed by OpenAI. Feb 19, 2023 ... ChatGPT is an AI chatbot system that OpenAI released in November to show off and test what a very large, powerful AI system can accomplish. You ... ChatGPT is fine-tuned from GPT-3.5, a language model trained to produce text. ChatGPT was optimized for dialogue by using Reinforcement Learning with Human ... 3 days ago ... Visual ChatGPT connects ChatGPT and a series of Visual Foundation Models to enable sending and receiving images during chatting. Dec 1, 2022 ... ChatGPT is a natural language processing tool driven by AI technology that allows you to have human-like conversations and much more with a ...\n    Thought: I now know the final answer.\n    Final Answer: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    \n    > Finished chain.\n\n\n\n\n\n    \"ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\"\n\nagent_chain.run(input=\"Who developed it?\")\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I need to find out who developed ChatGPT\n    Action: Search\n    Action Input: Who developed ChatGPT\n    Observation: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large ... Feb 15, 2023 ... Who owns Chat GPT? Chat GPT is owned and developed by AI research and deployment company, OpenAI. The organization is headquartered in San ... Feb 8, 2023 ... ChatGPT is an AI chatbot developed by San Francisco-based startup OpenAI. OpenAI was co-founded in 2015 by Elon Musk and Sam Altman and is ... Dec 7, 2022 ... ChatGPT is an AI chatbot designed and developed by OpenAI. The bot works by generating text responses based on human-user input, like questions ... Jan 12, 2023 ... In 2019, Microsoft invested $1 billion in OpenAI, the tiny San Francisco company that designed ChatGPT. And in the years since, it has quietly ... Jan 25, 2023 ... The inside story of ChatGPT: How OpenAI founder Sam Altman built the world's hottest technology with billions from Microsoft. Dec 3, 2022 ... ChatGPT went viral on social media for its ability to do anything from code to write essays. · The company that created the AI chatbot has a ... Jan 17, 2023 ... While many Americans were nursing hangovers on New Year's Day, 22-year-old Edward Tian was working feverishly on a new app to combat misuse ... ChatGPT is a language model created by OpenAI, an artificial intelligence research laboratory consisting of a team of researchers and engineers focused on ... 1 day ago ... Everyone is talking about ChatGPT, developed by OpenAI. This is such a great tool that has helped to make AI more accessible to a wider ...\n    Thought: I now know the final answer\n    Final Answer: ChatGPT was developed by OpenAI.\n    \n    > Finished chain.\n\n\n\n\n\n    'ChatGPT was developed by OpenAI.'\n\nagent_chain.run(\n    input=\"Thanks. Summarize the conversation, for my daughter 5 years old.\"\n)\n\n    \n    \n    > Entering new AgentExecutor chain...\n    Thought: I need to simplify the conversation for a 5 year old.\n    Action: Summary\n    Action Input: My daughter 5 years old\n    \n    > Entering new LLMChain chain...\n    Prompt after formatting:\n    This is a conversation between a human and a bot:\n    \n    Human: What is ChatGPT?\n    AI: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    Human: Who developed it?\n    AI: ChatGPT was developed by OpenAI.\n    \n    Write a summary of the conversation for My daughter 5 years old:\n    \n    \n    > Finished chain.\n    \n    Observation: \n    The conversation was about ChatGPT, an artificial intelligence chatbot developed by OpenAI. It is designed to have conversations with humans and can also send and receive images.\n    Thought: I now know the final answer.\n    Final Answer: ChatGPT is an artificial intelligence chatbot developed by OpenAI that can have conversations with humans and send and receive images.\n    \n    > Finished chain.\n\n\n\n\n\n    'ChatGPT is an artificial intelligence chatbot developed by OpenAI that can have conversations with humans and send and receive images.'\n\n\nThe final answer is not wrong, but we see the 3rd Human input is actually from the agent in the memory because the memory was modified by the summary tool.\n\nprint(agent_chain.memory.buffer)\n\n    Human: What is ChatGPT?\n    AI: ChatGPT is an artificial intelligence chatbot developed by OpenAI and launched in November 2022. It is built on top of OpenAI's GPT-3 family of large language models and is optimized for dialogue by using Reinforcement Learning with Human-in-the-Loop. It is also capable of sending and receiving images during chatting.\n    Human: Who developed it?\n    AI: ChatGPT was developed by OpenAI.\n    Human: My daughter 5 years old\n    AI: \n    The conversation was about ChatGPT, an artificial intelligence chatbot developed by OpenAI. It is designed to have conversations with humans and can also send and receive images.\n    Human: Thanks. Summarize the conversation, for my daughter 5 years old.\n    AI: ChatGPT is an artificial intelligence chatbot developed by OpenAI that can have conversations with humans and send and receive images.\n\nPrevious\nReplicating MRKL\nNext\nStreaming final agent output"
}